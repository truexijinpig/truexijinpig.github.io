<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ‡¸è³é€šå‘Šç”¢ç”Ÿå™¨</title>
<link data-default-icon="xi.jpg" rel="icon"
        sizes="192x192" href="xi.jpg" />
    <meta name="bingbot" content="noarchive" />
    <meta name="robots" content="noarchive, noimageindex" />
    <meta name="copyright" content="https://github.com/EDUtw2016" />
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta id="viewport" name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2, viewport-fit=cover" />
    <meta name="theme-color" content="#FF0000" />
    <meta name="theme-color" content="#8c0500" media="(prefers-color-scheme: dark)" />
    <link rel="apple-touch-icon" sizes="76x76"
        href="xi.jpg" />
    <link rel="apple-touch-icon" sizes="120x120"
        href="xi.jpg" />
    <link rel="apple-touch-icon" sizes="152x152"
        href="xi.jpg" />
    <link rel="apple-touch-icon" sizes="167x167"
        href="xi.jpg" />
    <link rel="apple-touch-icon" sizes="180x180"
        href="xi.jpg" />
    <link data-default-icon="xi.jpg" rel="shortcut icon"
        type="image/x-icon" href="xi.jpg" />
    <meta property="og:site_name" content="èˆ‡ç¿’è¿‘å¹³å°è©±" />
    <meta property="og:title" content="æ‡¸è³é€šå‘Šç”Ÿæˆå™¨" />
    <meta property="og:image" content="xi.jpg" />
    <meta property="fb:app_id" content="124024574287414" />
    <meta name="description"
        content="ç”Ÿæˆæ‡¸è³é€šå‘Š åŸ https://github.com/EDUtw2016/china.reward" />
<meta name="og:description"
        content="ç”Ÿæˆæ‡¸è³é€šå‘Š åŸ https://github.com/EDUtw2016/china.reward" />
    <meta name="application-title" content="æ‡¸è³é€šå‘Šç”Ÿæˆå™¨" />
    <meta name="color-scheme" content="light" />
<style>
/*{box-sizing:border-box}*/
a{ background:#383;
padding: 1px;border-radius: 5px;color: #fff;
}
body{
  margin:0;padding:20px;
  background:#f0f2f5;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang TC","Microsoft JhengHei",sans-serif;
  display:flex;gap:20px;
}
.panel{
  position:fixed;
  z-index:1;
  width:30vh;
  background:#fff;border-radius:12px;
  padding:20px;box-shadow:0 4px 12px rgba(0,0,0,0.08);
  transition:all 0.2s ease-in-out;
  overflow-y:scroll;display:flex;
flex-direction: column;
    align-items: center;
}
.panel h2{margin:0 0 1vh;}
panel p{
 margin:0.2vh;
}
.form-group{margin:0.5vh;}
.form-group label{font-size:14px;display:block}
.form-group input,.form-group select,.form-group textarea{
  width:100%;padding:6px 8px;font-size:14px;
  border:1px solid #d0d4da;border-radius:6px;box-shadow:0 0 0.5vh #ddd5;
}
textarea{resize:vertical;min-height:60px}

.button-row{display:flex;gap:0.5vh}
button{
  padding:8px 14px;border-radius:999px;border:none;
  background:#2563eb;color:#fff;cursor:pointer;font-size:14px;
}
#btnDownload{background:#059669}

.poster-wrapper{flex:1;display:flex;justify-content:center}
.poster{
  width:30vh;background:#fff;border:1px solid #d0d4da;background:#e5f2ff;
  border-radius:0.4vh;overflow:hidden;position:relative;
}

/* Header */
.poster-header{
  background:#0046a5;color:#fff;display:flex;
  align-items:center;gap:8vh;padding:0.5vh 1vh;
}
.badge{width:3.6vh;height:3.6vh}
.badge img{width:100%;height:100%;object-fit:contain}
.poster-title{font-size:1.6vh;font-weight:700;letter-spacing:0.4vh;}

/* Photo section */
.photo-strip{
  background:#e5f2ff;padding:1.2vh 1.5vh 1.6vh;
}
.photo-frame{
  width:9vh ; height:11vh;margin:0 auto 0.5vh;
  border:1px solid #9ca3af;background:#fff;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}
.photo-frame img{
  width:100%;height:100%;object-fit:cover
}
.name-line{
  font-size:1vh;font-weight:600;letter-spacing:0.2vh;text-align:center;
}
.id-line{text-align:center;font-size:0.75vh;color:#374151}

/*.divider{height:0.05vh;background:#f00}*/

/* Crime section */
.crime-section{
  margin:1vh;
  padding:1vh 1.5vh 5vh;
  font-size:0.75vh;line-height:1vh;text-align:text-start;background:#fff;
  border:1px solid #ddd;
}

/* blue bar */
.phone-bar{
  position:absolute;left:1.8vh;bottom:1.8vh;
  background:#003b8f;color:#fff;font-size:0.75vh;
  padding:0.3vh; 14px;border-radius:0.2vh;display:flex;gap:0.4vh;
}
.phone-icon{
  width:1vh;height:1vh;border-radius:50%;
  border:1px solid #fff;display:flex;align-items:center;justify-content:center;
  font-size:0.55vh;
}

/* Stamp */
.stamp{
  position:absolute;right:2vh;bottom:3vh;
  width:7.5vh;height:7.5vh;border-radius:50%;
  border:0.2vh solid #ef4444;color:#ef4444;
  transform:rotate(-12deg);pointer-events:none;
}
.stamp-star{
  position:absolute;top:38%;left:50%;
  transform:translate(-50%,-50%);
  font-size:3vh;line-height:1;
}
.stamp-circle{
  position:absolute;top:50%;left:50%;
  width:6vh;height:6vh;transform:translate(-50%,-50%);
}
.stamp-circle span{
  position:absolute;font-size:0.75vh;font-weight:700;color:#ef4444;
}
.stamp-date{
  position:absolute;bottom:0.9vh;left:50%;
  transform:translateX(-50%);font-size:0.6vh;color:#ef4444;
}

.emphasis{font-weight:700;text-decoration:underline}
#opcp{
 font-size:1vh;
 background: #fff;
 padding: 1vh;
 position: fixed;
 top: 10vh;
 left: 0vh;
 z-index:2;
 border-radius: 3vh;
 box-shadow:0 0 1vh #2224;
}
</style>
</head>
<body>
<div id="opcp">é–‹é—œç·¨è¼¯å°</div>
<div class="panel">
  <h2>æ‡¸è³é€šå‘Šç”¢ç”Ÿå™¨</h2>
  <p>æ”¹ç·¨è‡ª<a href="https://github.com/EDUtw2016" traget="_blank">EDUtw2016</a>çš„ä½œå“<a href="https://github.com/EDUtw2016/china.reward" target="_blank">æ‡¸è³é€šå‘Š</a>è¬åˆ†æ„Ÿè¬ğŸ™</p>
  <div class="form-group">
    <label>å§“å</label>
    <input id="inputName" type="text">
  </div>

  <div class="form-group">
    <label>æ€§åˆ¥</label>
    <select id="inputGender">
      <option value="ç”·">ç”·</option>
      <option value="å¥³">å¥³</option>
      <option value="å…¶ä»–">å…¶ä»–</option>
    </select>
  </div>

  <div class="form-group">
    <label>æˆ¶ç±åœ°ï¼ˆæ±ºå®šèº«åˆ†è­‰å­—é¦–ï¼‰</label>
    <select id="inputHousehold">
      <option value="">éš¨æ©Ÿ</option>
      <option value="A">å°åŒ—å¸‚</option>
      <option value="F">æ–°åŒ—å¸‚</option>
      <option value="B">å°ä¸­å¸‚</option>
      <option value="D">å°å—å¸‚</option>
      <option value="E">é«˜é›„å¸‚</option>
      <option value="C">åŸºéš†å¸‚</option>
      <option value="H">æ¡ƒåœ’å¸‚</option>
      <option value="I">å˜‰ç¾©å¸‚</option>
      <option value="O">æ–°ç«¹å¸‚</option>
      <option value="G">å®œè˜­ç¸£</option>
      <option value="J">æ–°ç«¹ç¸£</option>
      <option value="K">è‹—æ —ç¸£</option>
      <option value="L">å°ä¸­ç¸£</option>
      <option value="M">å—æŠ•ç¸£</option>
      <option value="N">å½°åŒ–ç¸£</option>
      <option value="P">é›²æ—ç¸£</option>
      <option value="Q">å˜‰ç¾©ç¸£</option>
      <option value="R">å°å—ç¸£</option>
      <option value="S">é«˜é›„ç¸£</option>
      <option value="T">å±æ±ç¸£</option>
      <option value="U">èŠ±è“®ç¸£</option>
      <option value="V">å°æ±ç¸£</option>
      <option value="X">æ¾æ¹–ç¸£</option>
      <option value="W">é‡‘é–€ç¸£</option>
      <option value="Z">é€£æ±Ÿç¸£</option>
    </select>
  </div>

  <div class="form-group">
    <label>èº«ä»½æè¿°</label>
    <input id="inputIdentity" type="text">
  </div>

  <div class="form-group">
    <label>æ‡¸è³é‡‘é¡ï¼ˆè‡ªç”±è¼¸å…¥ï¼š1.5è¬ / 200å…ƒ / 3ä¸‡äººæ°‘å¸ï¼‰</label>
    <div style="display:flex;gap:6px">
      <input id="inputRewardMin" type="text" placeholder="æœ€ä½">
      <span>è‡³</span>
      <input id="inputRewardMax" type="text" placeholder="æœ€é«˜">
    </div>
  </div>

  <div class="form-group">
    <label>çŠ¯ç½ªäº‹ç”±ï¼ˆ50å­—å…§ï¼‰</label>
    <textarea id="inputReason">å™¨å®˜æ¶åŠ«ã€æ´—éŒ¢ã€æ®ºå®³è—äººã€é•åä¸­è¯æ°‘åœ‹æ†²æ³•â€¦â€¦</textarea>
  </div>

  <div class="form-group">
    <label>ä¸Šå‚³ç…§ç‰‡</label>
    <input id="inputPhoto" type="file" accept="image/*">
  </div>

  <div class="button-row">
    <button id="btnGenerate">ç”Ÿæˆ</button>
    <button id="btnDownload">ä¸‹è¼‰PNG</button>
  </div>
  <div class="form-group">
  <h3>ç”Ÿæˆæ–‡æœ¬é è¦½</h3>
  <p>èƒ½æ›´è‡ªç”±çš„ä¿®æ”¹</p>
  <textarea id="previewtxt" style="min-height:40vh;"></textarea>
  </div>
  <a href="https://discord.gg/QzpD2nwjXR" target="_blank"><img src="dc.ico" alt="Discord"></a><a href="/" style="font-size:3vh ;border-radius: 3vh;background: #8098ff;padding: 1vh;">çµ¦ä¸»å¸­æ‰“é›»è©±</a>
  <a href="/mg" style="font-size:2vh ;border-radius: 3vh;background: #d50;padding: 1vh 2vh;">è¿‘å¹³éŸ³éŠ</a>
</div>

<div class="poster-wrapper">
<div class="poster" id="poster">
  <div class="poster-header">
    <div class="badge"><img src="badge.png"></div>
    <div class="poster-title">æ‚¬èµé€šå‘Š</div>
  </div>

  <div class="photo-strip">
    <div class="photo-frame">
      <img id="photoPreview">
    </div>
    <div class="name-line">
      <span id="posterName">æŸæŸ</span>
      <span id="posterGender">ç”·</span>
    </div>
    <div class="id-line">ä¸­å›½å°æ¹¾çœèº«ä»½è¯å·ç  <span id="posterId">A123456789</span></div>
  </div>

  <div class="divider"></div>

  <div class="crime-section">
    <div id="crimeText">ï¼ˆçŠ¯ç½ªæ®µè½å°‡åœ¨æ­¤å‘ˆç¾ï¼‰</div>
    <div style="text-align:right;margin-top:20px" id="issuerText">
      æŸæŸå¸‚å…¬å®‰å±€ã€€2025å¹´1æœˆ1æ—¥
    </div>
  </div>

  <div class="phone-bar">
    <div class="phone-icon">â˜</div> ä¸¾æŠ¥ç”µè¯ï¼šè¯·å¹¿å¤§ç¾¤ä¼—ç§¯ææä¾›çº¿ç´¢
  </div>

  <div class="stamp">
    <div class="stamp-star">â˜…</div>
    <div class="stamp-circle" id="stampCircle"></div>
    <div class="stamp-date" id="stampDate">2025å¹´1æœˆ1æ—¥</div>
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
 
/*å·¥ä½œå°é–‹é—œ*/
var paneloc=false;
openandcl();
xi("opcp").addEventListener("click",openandcl);
function openandcl() {

 this.innerText=(paneloc?"é–‹å•Ÿ":"éš±è—")+"ç·¨è¼¯å€";
 if (paneloc){
  css(qq(".panel")[0],{top:"150vh"});
 }else{
  if (window.innerHeight>window.innerWidth){
   css(qq(".panel")[0],{top:"50vh",height:"50vh",width:"90vw"});
  }else{
   css(qq(".panel")[0],{top:"1vh",height:"90vh",width:"30vh"});
  }
 }
 paneloc=!paneloc;
}
function css(element, rules){
 for (let property in rules){
  if (rules.hasOwnProperty(property)){
   element.style[property] = rules[property];
  }
 }
}
function xi(t) {
 return document.getElementById(t);
}
function qq(t) {
 return document.querySelectorAll(t)
}

xi("previewtxt").addEventListener("input",function () {
 xi("crimeText").innerHTML= escapeHtml(this.value).replaceAll(/__(.*?)__/gim, '<span class="emphasis">$1</span>');
})
/* ============================================================
   0. è¼•é‡ç¹â†’ç°¡è½‰æ›ï¼ˆå¿…è¦å­—éƒ½è¶³å¤ ï¼Œéœ€æ“´å……æˆ‘ä¹Ÿèƒ½åŠ ï¼‰
============================================================ */
const tradToSimpMap = {
  "è‡º":"å°","ç£":"æ¹¾","å€‘":"ä»¬","æœƒ":"ä¼š","é«”":"ä½“","ç‚º":"ä¸º","é–‹":"å¼€","é—œ":"å…³",
  "èˆ‡":"ä¸","ç„¡":"æ— ","é€™":"è¿™","èªª":"è¯´","å­¸":"å­¦","ç¶“":"ç»","é¸":"é€‰","åœ‹":"å›½",
  "é•·":"é•¿","æ™‚":"æ—¶","å¾Œ":"å","è£¡":"é‡Œ","è£":"é‡Œ","è©±":"è¯","è®€":"è¯»","å€":"åŒº",
  "å¯¦":"å®","å ±":"æŠ¥","æ¥µ":"æ","å‹™":"åŠ¡","å»£":"å¹¿","ç™¼":"å‘","é«”":"ä½“","é†«":"åŒ»",
  "è­‰":"è¯","æ“š":"æ®","ç·š":"çº¿","å„ª":"ä¼˜","è™Ÿ":"å·","é¢¨":"é£","å¸¶":"å¸¦","æ„›":"çˆ±",
  "é–€":"é—¨","é ‚":"é¡¶","è¾¦":"åŠ","è™•":"å¤„","é—œ":"å…³"
};
function toSimplified(str){
  return str.replace(/[\u4e00-\u9fa5]/g,ch=>tradToSimpMap[ch]||ch);
}

/* ============================================================
   1. èº«åˆ†è­‰å­—é¦– mapping
============================================================ */
const idMapping = {
  A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,J:18,K:19,
  L:20,M:21,N:22,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,
  X:30,Y:31,W:32,Z:33,I:34,O:35
};
const letterList = "ABCDEFGHJKLMNPQRSTUVXYWZIO";

/* ============================================================
   2. ç”¢ç”Ÿå½èº«åˆ†è­‰ï¼ˆæ ¼å¼æ­£ç¢ºã€æ ¡é©—éŒ¯èª¤ï¼‰
============================================================ */
function generateFakeTaiwanId(gender, area){
  let letter = area || letterList[Math.floor(Math.random()*letterList.length)];
  const genderDigit = (gender==="å¥³") ? 2 : 1;

  const nums = [genderDigit];
  for(let i=0;i<7;i++) nums.push(Math.floor(Math.random()*10));
  nums.push(Math.floor(Math.random()*10));

  const code=idMapping[letter];
  const c1=Math.floor(code/10), c2=code%10;

  const all=[c1,c2].concat(nums);
  let sum=all[0] + all[1]*9;
  let w=8;
  for(let i=2;i<all.length;i++,w--) sum+=all[i]*w;

  if(sum%10===0) nums[8]=(nums[8]+1)%10;

  return letter + nums.join("");
}

/* ============================================================
   3. å…¨å½¢é‡‘é¡è™•ç†
============================================================ */
function normalizeAmountStr(str){
  if(!str) return "";
  return toSimplified(str.replace(/\s+/g,""));
}

function buildRewardDisplay(minInput,maxInput){
  let min=normalizeAmountStr(minInput);
  let max=normalizeAmountStr(maxInput);

  if(!min && !max) return "5ä¸‡è‡³10ä¸‡å…ƒäººæ°‘å¸";
  if(!min) return max;
  if(!max) return min;

  const bothYuan = min.endsWith("å…ƒ") && max.endsWith("å…ƒ");
  if(bothYuan){
    return min.slice(0,-1) + "è‡³" + max;
  }

  const bothWan = /ä¸‡$/.test(min) && /ä¸‡$/.test(max);
  if(bothWan){
    return `${min}è‡³${max}å…ƒ`;
  }

  return `${min}è‡³${max}`;
}

/* ============================================================
   4. ç´…è‰²å°ç« ç’°å½¢æ–‡å­—
============================================================ */
function setStampBureau(text){
  const circle=document.getElementById("stampCircle");
  circle.innerHTML="";
  const chars=text.split("");
  const radius=58, cx=60, cy=60;
  const start=-Math.PI*0.9, end=-Math.PI*0.1;
  const step=(chars.length>1)?(end-start)/(chars.length-1):0;

  chars.forEach((ch,i)=>{
    const ang=start+step*i;
    const x=cx+radius*Math.cos(ang);
    const y=cy+radius*Math.sin(ang);
    const s=document.createElement("span");
    s.textContent=ch;
    s.style.left=x/20+"vh";
    s.style.top=y/20+"vh";
    s.style.transform=`translate(-50%,-50%) rotate(${ang+Math.PI/2}rad)`;
    circle.appendChild(s);
  });
}

/* ============================================================
   5. çŠ¯ç½ªæ®µè½
============================================================ */
function escapeHtml(str){
  return str.replace(/[&<>"]/g, ch => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[ch]));
}

function generateCrimeText(name, identity, reason, reward){
  let emName    = `<span class="emphasis">${escapeHtml(name)}</span>`;
  let emId      = `<span class="emphasis">${escapeHtml(identity)}</span>`;
  let emReason  = `<span class="emphasis">${escapeHtml(reason)}</span>`;
  let emReward  = escapeHtml(reward);

  return (
    `æˆ‘å±€å·¥ä½œæŒæ¡ï¼Œ${emName}ï¼Œ${emId}ï¼Œ${emReason}ï¼Œ` +
    `é•¿æœŸåˆ©ç”¨å…¶èº«ä»½åœ¨å¢ƒå¤–ç¤¾äº¤å¹³å°å‘å¸ƒã€ä¼ æ’­æ¶‰å°æ¶‰æ”¿ä¸å®ä¿¡æ¯ï¼Œ` +
    `æ¶æ„æ”»å‡»æŠ¹é»‘å›½å®¶å’Œæ”¿åºœå½¢è±¡ï¼Œç…½åŠ¨éƒ¨åˆ†ä¸æ˜çœŸç›¸ç¾¤ä¼—äº§ç”Ÿæ•Œå¯¹æƒ…ç»ªï¼Œ` +
    `å¤šæ¬¡ä¸å¢ƒå†…å¤–åˆ†è£‚åŠ¿åŠ›å‹¾è¿ä¸²è”ï¼Œä»äº‹æŸå®³å›½å®¶ç»Ÿä¸€å’Œç¤¾ä¼šç¨³å®šçš„æ´»åŠ¨ï¼Œ` +
    `é€ æˆæ¶åŠ£ç¤¾ä¼šå½±å“ã€‚å…¶è¡Œä¸ºå·²è§¦çŠ¯ã€Šä¸­åäººæ°‘å…±å’Œå›½åˆ‘æ³•ã€‹ç¬¬ä¸€ç™¾é›¶ä¸‰æ¡ä¹‹è§„å®šï¼Œæ¶‰å«Œç…½åŠ¨åˆ†è£‚å›½å®¶ç½ªã€‚` +
    `ä¸ºä¾æ³•ä¸¥å‰æ‰“å‡»ç ´åå›½å®¶ä¸»æƒå’Œé¢†åœŸå®Œæ•´çš„çŠ¯ç½ªè¡Œä¸ºï¼Œåˆ‡å®ç»´æŠ¤å›½å®¶å®‰å…¨ï¼Œè¯·å¹¿å¤§ç¾¤ä¼—ç§¯ææä¾›çº¿ç´¢ï¼Œ` +
    `å‡¡å‘å…¬å®‰æœºå…³æä¾›æœ‰æ•ˆçº¿ç´¢çš„ä¸¾æŠ¥äººï¼Œä»¥åŠé…åˆå…¬å®‰æœºå…³æŠ“è·ç›¸å…³çŠ¯ç½ªå«Œç–‘äººçš„æœ‰åŠŸäººå‘˜ï¼Œ` +
    `æˆ‘å±€å°†è§†æƒ…ç»™äºˆ${emReward}çš„å¥–åŠ±ã€‚` +
    `å¯¹åŒ…åº‡åœ¨é€ƒäººå‘˜çš„ï¼Œå°†ä¾æ³•è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚å¯¹æ‰“å‡»æŠ¥å¤ä¸¾æŠ¥äººçš„ï¼Œå°†ä¾æ³•ä¸¥æƒ©ã€‚`
  );
}

/* ============================================================
   6. æ—¥æœŸ
============================================================ */
function formatCNDate(date=new Date()){
  return `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
}

/* ============================================================
   7. å¯¦ä½œ DOM
============================================================ */
const bureaus=[
  "åŒ—äº¬å¸‚å…¬å®‰å±€","ä¸Šæµ·å¸‚å…¬å®‰å±€","å»£å·å¸‚å…¬å®‰å±€","æ·±åœ³å¸‚å…¬å®‰å±€","æ­å·å¸‚å…¬å®‰å±€",
  "å—äº¬å¸‚å…¬å®‰å±€","æˆéƒ½å¸‚å…¬å®‰å±€","é‡æ…¶å¸‚å…¬å®‰å±€","æ­¦æ¼¢å¸‚å…¬å®‰å±€","è¥¿å®‰å¸‚å…¬å®‰å±€",
  "ç¦å·å¸‚å…¬å®‰å±€","å»ˆé–€å¸‚å…¬å®‰å±€","é’å³¶å¸‚å…¬å®‰å±€","è˜‡å·å¸‚å…¬å®‰å±€"
];

/* --- ç…§ç‰‡é è¦½ --- */
document.getElementById("inputPhoto").addEventListener("change",e=>{
  const f=e.target.files[0];
  const img=document.getElementById("photoPreview");
  if(!f){ img.src=""; return; }
  const r=new FileReader();
  r.onload=ev=>img.src=ev.target.result;
  r.readAsDataURL(f);
});

/* --- ç”ŸæˆæŒ‰éˆ• --- */
document.getElementById("btnGenerate").addEventListener("click",()=>{
  let name  = toSimplified(document.getElementById("inputName").value.trim()||"æŸæŸ");
  let gender= document.getElementById("inputGender").value;
  let area  = document.getElementById("inputHousehold").value || "";

  let identity = toSimplified(document.getElementById("inputIdentity").value.trim()||"å°æ¹¾å±…æ°‘");
  let reason   = toSimplified(document.getElementById("inputReason").value.trim()||"é•¿æœŸåœ¨å¢ƒå¤–ç¤¾äº¤å¹³å°å‘å¸ƒæ¶‰æ”¿è¨€è®º");

  let rMinRaw = toSimplified(document.getElementById("inputRewardMin").value.trim());
  let rMaxRaw = toSimplified(document.getElementById("inputRewardMax").value.trim());
  let reward  = buildRewardDisplay(rMinRaw,rMaxRaw);

  /* æ›´æ–°å§“åã€æ€§åˆ¥ã€èº«ä»½è­‰ */
  document.getElementById("posterName").textContent=name;
  document.getElementById("posterGender").textContent=gender;

  let fakeId = generateFakeTaiwanId(gender,area);
  document.getElementById("posterId").textContent=fakeId;

  /* çŠ¯ç½ªæ®µè½ */
  let gent= generateCrimeText(name,identity,reason,reward);
  xi("previewtxt").value=gent.replaceAll(`<span class="emphasis">`,"__").replaceAll("</span>","__");
  document.getElementById("crimeText").innerHTML = gent
    

  /* å…¬å®‰å±€ + æ—¥æœŸ */
  let bureau=bureaus[Math.floor(Math.random()*bureaus.length)];
  let dateStr=formatCNDate();

  setStampBureau(bureau);
  document.getElementById("stampDate").textContent=dateStr;
  document.getElementById("issuerText").innerHTML =
    `${bureau}ã€€${dateStr}`;
});

/* ============================================================
   8. ä¸‹è¼‰ PNGï¼ˆæ‰‹æ©Ÿä¸é–ƒé€€ï¼‰
============================================================ */
document.getElementById("btnDownload").addEventListener("click",()=>{
  const poster=document.getElementById("poster");
  const isMobile=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  const scale=isMobile?6:12;

  html2canvas(poster,{
    scale, useCORS:true, allowTaint:true,
    width:poster.clientWidth,
    height:poster.clientHeight
  }).then(canvas=>{
    
    const dataUrl=canvas.toDataURL("image/png");
    

    if(isMobile){
      const w=window.open();
      if(w){
        w.document.title="æ‡¸è³é€šå‘Š";
        w.document.body.style.margin="0";
        w.document.body.innerHTML=`<img src="${dataUrl}" style="width:100%;display:block">`;
      } else {
        window.location.href=dataUrl;
      }
    }
      const a=document.createElement("a");
      a.href=dataUrl;
      a.download=`reward_${Date.now()}.png`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    
  });
});

/* åˆå§‹è‡ªå‹•ç”Ÿæˆä¸€æ¬¡ */
document.getElementById("btnGenerate").click();
</script>

</body>
</html>
